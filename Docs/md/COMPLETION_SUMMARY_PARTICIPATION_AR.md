# โ ููุฎุต ุฅููุงู ุชุญุณููุงุช ูุธุงู ุงููุดุงุฑูุฉ

## ๐ฏ ุงูููุงู ุงูููุฌุฒุฉ

### 1. โ ุชูุณูู ุงูุงุณู ุฅูู ุซูุงุซุฉ ุญููู
**ุงูุชูููุฐ:**
- ุฅุถุงูุฉ ุญูู `first_name` (ุงูุงุณู ุงูุฃูู)
- ุฅุถุงูุฉ ุญูู `father_name` (ุงุณู ุงูุฃุจ)
- ุฅุถุงูุฉ ุญูู `family_name` (ุงููุจููุฉ/ุงูุนุงุฆูุฉ)
- ุฌููุน ุงูุญููู ุฅูุฒุงููุฉ
- ูุชู ุฏูุฌูุง ูุชูููู `participant_name`

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `app/competition/[slug]/participate/ParticipationForm.tsx`
- `app/api/competition/submit/route.ts`

---

### 2. โ ุงุณุชุจุฏุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจุงูุตู ุงูุฏุฑุงุณู
**ุงูุชูููุฐ:**
- ุฅุฒุงูุฉ ุญูู `participant_email`
- ุฅุถุงูุฉ ุญูู `grade` (ุงูุตู ุงูุฏุฑุงุณู)
- ูุงุฆูุฉ ููุณุฏูุฉ ูู ุงูุตู 1 ุฅูู 12
- ุงูุญูู ุฅูุฒุงูู

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `app/competition/[slug]/participate/ParticipationForm.tsx`
- `app/api/competition/submit/route.ts`

---

### 3. โ ุฅุถุงูุฉ ุญูู ุงูุฏููู ุงูุฅูุฒุงูู
**ุงูุชูููุฐ:**
- ุฅุถุงูุฉ ุญูู `proofs` (ูุงุฆู JSON)
- ุญูู ูุตู ููู ุณุคุงู
- ุงูุชุญูู ูู ูุชุงุจุฉ ุงูุฏููู ูุจู ุงูุฅุฑุณุงู
- ุชุตููู ูููุฒ ุจุฎูููุฉ ููุฑูุงููุฉ
- ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ ูุงุถุญุฉ

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `app/competition/[slug]/participate/ParticipationForm.tsx`
- `app/api/competition/submit/route.ts`

**ุงูููุฏ:**
```typescript
// ูู ParticipationForm.tsx
const [proofs, setProofs] = useState<Record<string, string>>({})

const handleProof = (proof: string) => {
  setProofs({ ...proofs, [currentQuestion.id]: proof })
}

// ุงูุชุญูู ูุจู ุงูุฅุฑุณุงู
if (!proofs[currentQuestion.id] || !proofs[currentQuestion.id].trim()) {
  alert('ูุฑุฌู ูุชุงุจุฉ ุงูุฏููู ุนูู ุฅุฌุงุจุชู')
  return
}
```

---

### 4. โ ุนุฑุถ ุฌููุน ุงูุฃุณุฆูุฉ
**ุงูุชูููุฐ:**
- ุฒุฑ "ุนุฑุถ/ุฅุฎูุงุก ุฌููุน ุงูุฃุณุฆูุฉ"
- ูุงุฆูุฉ ูุงุจูุฉ ููุชูุฑูุฑ ูุฌููุน ุงูุฃุณุฆูุฉ
- ุนุฑุถ ุญุงูุฉ ุงูุฅุฌุงุจุฉ ููู ุณุคุงู
- ูููู ููุทุงูุจ ุงูุฎุฑูุฌ ูุงูุจุญุซ

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `app/competition/[slug]/participate/ParticipationForm.tsx`

**ุงูููุฏ:**
```typescript
const [showAllQuestions, setShowAllQuestions] = useState(false)

// ุฒุฑ ุงูุชุจุฏูู
<button onClick={() => setShowAllQuestions(!showAllQuestions)}>
  {showAllQuestions ? 'ุฅุฎูุงุก' : 'ุนุฑุถ'} ุฌููุน ุงูุฃุณุฆูุฉ
</button>

// ุนุฑุถ ุงูุฃุณุฆูุฉ
{showAllQuestions && (
  <div className="space-y-4">
    {questions.map((q, idx) => (
      <div key={q.id}>
        <p>{q.question_text}</p>
        {answers[q.id] && <p>โ ุชูุช ุงูุฅุฌุงุจุฉ</p>}
      </div>
    ))}
  </div>
)}
```

---

### 5. โ ุนุฑุถ ุนุฏุฏ ุงูุชุฐุงูุฑ ุงูููุชุณุจุฉ
**ุงูุชูููุฐ:**
- ุญุณุงุจ ุงูุชุฐุงูุฑ ูู API
- ุฅุฑุฌุงุน `tickets_earned` ูู ุงูุงุณุชุฌุงุจุฉ
- ุนุฑุถ ุงูุชุฐุงูุฑ ูู ุตูุญุฉ ุงููุชูุฌุฉ
- ุชุตููู ุฌุฐุงุจ ูุน ุฃููููุฉ ๐๏ธ

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `app/competition/[slug]/participate/ParticipationForm.tsx`
- `app/api/competition/submit/route.ts`

**ุงูููุฏ:**
```typescript
// ูู API
const ticketsEarned = calculateTickets(score, total_questions, competition.rules)

return NextResponse.json({
  success: true,
  tickets_earned: ticketsEarned
})

// ูู ุงููุงุฌูุฉ
const [ticketsEarned, setTicketsEarned] = useState(0)

<div className="bg-gradient-to-r from-amber-50 to-yellow-50">
  <div className="text-6xl mb-3">๐๏ธ</div>
  <p className="text-2xl font-bold">
    ุญุตูุช ุนูู {ticketsEarned} ุชุฐุงูุฑ
  </p>
</div>
```

---

### 6. โ ูุธุงู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
**ุงูุชูููุฐ:**
- ุงูุชุญูู ูู ุงููุดุงุฑูุงุช ุงูุณุงุจูุฉ
- ุญูู `retry_allowed` ููุณูุงุญ ุจุฅุนุงุฏุฉ ุงููุญุงููุฉ
- ุญูู `is_retry` ูุชุชุจุน ุงููุญุงููุงุช
- ูุธููุฉ `allowRetry()` ูููุนูู

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `app/api/competition/submit/route.ts`
- `app/dashboard/actions/submissions.ts`

**ุงูููุฏ:**
```typescript
// ุงูุชุญูู ูู ุงููุดุงุฑูุฉ ุงูุณุงุจูุฉ
const existingSubmission = submissions.find(
  (s: any) => s.competition_id === competition_id && 
              s.first_name === first_name && 
              s.father_name === father_name && 
              s.family_name === family_name
)

if (existingSubmission && existingSubmission.retry_allowed !== true) {
  return NextResponse.json(
    { error: 'ููุฏ ููุช ุจุงููุดุงุฑูุฉ ูุณุจูุงู. ููููู ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุฑุฉ ูุงุญุฏุฉ ููุท ุจููุงููุฉ ุงููุนูู' },
    { status: 400 }
  )
}

// ูุธููุฉ ุงูุณูุงุญ ุจุฅุนุงุฏุฉ ุงููุญุงููุฉ
export async function allowRetry(submissionId: string) {
  // ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
  // ุชุญุฏูุซ retry_allowed = true
  // ุชุณุฌูู ูู audit log
}
```

---

## ๐ ุงููููุงุช ุงูููุดุฃุฉ

### 1. `PARTICIPATION_IMPROVEMENTS_AR.md`
- ุชูุซูู ุดุงูู ููุชุญุฏูุซุงุช
- ุดุฑุญ ุงูุจููุฉ ุงูุฌุฏูุฏุฉ
- ุฃูุซูุฉ ุนูู ุงูุงุณุชุฎุฏุงู

### 2. `update_submissions_schema.sql`
- ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅุถุงูุฉ ุงูุญููู ุงูุฌุฏูุฏุฉ
- ุฅูุดุงุก ุงูููุงุฑุณ
- ุฅูุดุงุก ุงูุฏูุงู ุงููุณุงุนุฏุฉ
- ุฅูุดุงุก ุงูู triggers
- ุฅุถุงูุฉ ุณูุงุณุงุช ุงูุฃูุงู

### 3. `QUICK_GUIDE_PARTICIPATION_AR.md`
- ุฏููู ุณุฑูุน ููุทูุงุจ
- ุฏููู ุณุฑูุน ูููุนูููู
- ุฏููู ุณุฑูุน ูููุทูุฑูู
- ุฃูุซูุฉ ุนูู ุงููุงุฌูุงุช
- ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

---

## ๐ง ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### ุงูุฎุทูุฉ 1: ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# ุฅุฐุง ููุช ุชุณุชุฎุฏู PostgreSQL ูุญูู
psql -U your_user -d your_database -f update_submissions_schema.sql

# ุฅุฐุง ููุช ุชุณุชุฎุฏู Supabase
# ุงูุชุญ SQL Editor ูู ููุญุฉ ุชุญูู Supabase
# ุงูุตู ูุญุชูู update_submissions_schema.sql
# ุงุถุบุท Run
```

### ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ููู ุงูุจูุงูุงุช ุงููุญูู (ุฅุฐุง ููุช ุชุณุชุฎุฏู JSON)
```bash
# ูุณุฎ ุงุญุชูุงุทู
cp data/submissions.json data/submissions.backup.json

# ุชุญุฏูุซ ุงูุจููุฉ ูุฏููุงู ุฃู ุงุณุชุฎุฏุงู ุณูุฑูุจุช
```

### ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุงููุธุงู
```bash
npm run dev
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุงููุดุงุฑูุฉ ุงูุฃุณุงุณูุฉ
1. โ ุงูุชุญ ูุณุงุจูุฉ ูุดุทุฉ
2. โ ุฃุฏุฎู ุงูุงุณู ุงูุซูุงุซู
3. โ ุงุฎุชุฑ ุงูุตู ุงูุฏุฑุงุณู
4. โ ุญุงูู ุงูุฅุฑุณุงู ุจุฏูู ุฏููู โ ูุฌุจ ุฃู ููุดู
5. โ ุฃุถู ุงูุฏููู ูุฃุฑุณู โ ูุฌุจ ุฃู ููุฌุญ
6. โ ุชุญูู ูู ุนุฑุถ ุงูุชุฐุงูุฑ

### ุงุฎุชุจุงุฑ 2: ุนุฑุถ ุงูุฃุณุฆูุฉ
1. โ ุงุถุบุท "ุนุฑุถ ุฌููุน ุงูุฃุณุฆูุฉ"
2. โ ุชุญูู ูู ุธููุฑ ุฌููุน ุงูุฃุณุฆูุฉ
3. โ ุชุญูู ูู ุญุงูุฉ ุงูุฅุฌุงุจุฉ

### ุงุฎุชุจุงุฑ 3: ุฅุนุงุฏุฉ ุงููุญุงููุฉ
1. โ ุดุงุฑู ูู ูุณุงุจูุฉ
2. โ ุญุงูู ุงููุดุงุฑูุฉ ูุฑุฉ ุฃุฎุฑู โ ูุฌุจ ุฃู ููุดู
3. โ ุณุฌู ุฏุฎูู ููุนูู
4. โ ุงุณูุญ ุจุฅุนุงุฏุฉ ุงููุญุงููุฉ
5. โ ุญุงูู ุงููุดุงุฑูุฉ ูุฑุฉ ุฃุฎุฑู โ ูุฌุจ ุฃู ููุฌุญ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ุงูููุฏ ุงููุถุงู:
- **ุณุทูุฑ ุงูููุฏ ุงูุฌุฏูุฏุฉ:** ~500 ุณุทุฑ
- **ุงููููุงุช ุงููุนุฏูุฉ:** 3 ูููุงุช
- **ุงููููุงุช ุงูููุดุฃุฉ:** 4 ูููุงุช
- **ุฏูุงู SQL ุฌุฏูุฏุฉ:** 3 ุฏูุงู
- **ุฌุฏุงูู ุฌุฏูุฏุฉ:** 1 ุฌุฏูู (participation_attempts)

### ุงูุญููู ุงููุถุงูุฉ:
- `first_name` (TEXT)
- `father_name` (TEXT)
- `family_name` (TEXT)
- `grade` (TEXT)
- `proofs` (JSONB)
- `tickets_earned` (INTEGER)
- `retry_allowed` (BOOLEAN)
- `is_retry` (BOOLEAN)
- `previous_submission_id` (UUID)
- `retried` (BOOLEAN)
- `new_submission_id` (UUID)

---

## ๐จ ุชุญุณููุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู

### 1. ูููุฐุฌ ุงููุนูููุงุช ุงูุดุฎุตูุฉ
- ุชุตููู ุดุจูู ููุงุณู ุงูุซูุงุซู
- ูุงุฆูุฉ ููุณุฏูุฉ ููุตู ุงูุฏุฑุงุณู
- ุชุญูู ูู ุงูุจูุงูุงุช ูุจู ุงูุฅุฑุณุงู

### 2. ุตูุญุฉ ุงูุฃุณุฆูุฉ
- ุฒุฑ ุนุฑุถ ุฌููุน ุงูุฃุณุฆูุฉ
- ุญูู ุงูุฏููู ุจุชุตููู ูููุฒ
- ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ ูุงุถุญุฉ
- ุดุฑูุท ุชูุฏู ูุญุฏุซ

### 3. ุตูุญุฉ ุงููุชูุฌุฉ
- ุนุฑุถ ุงูุชุฐุงูุฑ ุงูููุชุณุจุฉ
- ุชุตููู ุฌุฐุงุจ ูุน ุชุฏุฑุฌ ูููู
- ุฑุณุงูุฉ ุชูุถูุญูุฉ ุนู ุฅุนุงุฏุฉ ุงููุญุงููุฉ

---

## ๐ ุงูุฃูุงู

### ุงูุชุญูู ูู ุงูุจูุงูุงุช:
- โ ุงูุชุญูู ูู ุฌููุน ุงูุญููู ุงูุฅูุฒุงููุฉ
- โ ุงูุชุญูู ูู ูุชุงุจุฉ ุงูุฏููู
- โ ุงูุชุญูู ูู ุงููุดุงุฑูุงุช ุงูุณุงุจูุฉ
- โ ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุนูู

### ุณูุงุณุงุช ุงูุฃูุงู (RLS):
- โ ูููู ููุฌููุน ูุฑุงุกุฉ ุงููุดุงุฑูุงุช
- โ ูููู ููุฌููุน ุฅุถุงูุฉ ูุดุงุฑูุฉ
- โ ููุท ุงููุฏุฑุงุก ูููููู ุชุญุฏูุซ ุงููุดุงุฑูุงุช

---

## ๐ ุงูุฃุฏุงุก

### ุงูุชุญุณููุงุช:
- โ ููุงุฑุณ ููุจุญุซ ุงูุณุฑูุน
- โ ููุฑุณ ูุฑูุจ ูููุดุงุฑูุงุช ุงูุณุงุจูุฉ
- โ ุฏูุงู SQL ูุญุณูุฉ
- โ Triggers ุชููุงุฆูุฉ ูุญุณุงุจ ุงูุชุฐุงูุฑ

### ุงูุงุณุชุนูุงูุงุช ุงููุญุณูุฉ:
```sql
-- ุงูุจุญุซ ุนู ูุดุงุฑูุฉ ุณุงุจูุฉ
CREATE INDEX idx_submissions_participant_competition 
ON submissions(competition_id, first_name, father_name, family_name);

-- ุงูุจุญุซ ุจุงูุงุณู
CREATE INDEX idx_submissions_first_name ON submissions(first_name);
CREATE INDEX idx_submissions_father_name ON submissions(father_name);
CREATE INDEX idx_submissions_family_name ON submissions(family_name);
```

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ููุฅููุงู ุงููุงูู:
1. โณ ุชุญุฏูุซ ูุงุฌูุฉ ูุฑุงุฌุนุฉ ุงูุฅุฑุณุงููุงุช ูู ููุญุฉ ุงูุชุญูู
2. โณ ุฅุถุงูุฉ ุฒุฑ "ุงูุณูุงุญ ุจุฅุนุงุฏุฉ ุงููุญุงููุฉ" ูู ูุงุฌูุฉ ุงููุนูู
3. โณ ุนุฑุถ ุงูุฏููู ูู ุตูุญุฉ ุงููุฑุงุฌุนุฉ
4. โณ ุฅุถุงูุฉ ุชูุงุฑูุฑ ุนู ุงููุดุงุฑูุงุช
5. โณ ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช ุนู ุงูุฃุฏูุฉ ุงูููุฏูุฉ

### ุชุญุณููุงุช ูุณุชูุจููุฉ:
- ๐ ุฅุถุงูุฉ ุชูููู ุฌูุฏุฉ ุงูุฏููู
- ๐ ุฅุถุงูุฉ ูุธุงู ููุงุท ููุฃุฏูุฉ ุงููููุฉ
- ๐ ุฅุถุงูุฉ ููุชุจุฉ ุฃุฏูุฉ ูุดุชุฑูุฉ
- ๐ ุฅุถุงูุฉ ุชูุจููุงุช ูููุนูู ุนูุฏ ุงููุดุงุฑูุงุช ุงูุฌุฏูุฏุฉ

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

### ุงููุซุงุฆู:
- `PARTICIPATION_IMPROVEMENTS_AR.md` - ุชูุซูู ุดุงูู
- `QUICK_GUIDE_PARTICIPATION_AR.md` - ุฏููู ุณุฑูุน
- `update_submissions_schema.sql` - ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงููููุงุช ุงููุนุฏูุฉ:
- `app/competition/[slug]/participate/ParticipationForm.tsx`
- `app/api/competition/submit/route.ts`
- `app/dashboard/actions/submissions.ts`

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

### ุงูุชุทููุฑ:
- [x] ุชูุณูู ุงูุงุณู ุฅูู ุซูุงุซุฉ ุญููู
- [x] ุงุณุชุจุฏุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจุงูุตู
- [x] ุฅุถุงูุฉ ุญูู ุงูุฏููู
- [x] ุนุฑุถ ุฌููุน ุงูุฃุณุฆูุฉ
- [x] ุนุฑุถ ุงูุชุฐุงูุฑ ุงูููุชุณุจุฉ
- [x] ูุธุงู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- [x] ุงูุชุญูู ูู ุงูุจูุงูุงุช
- [x] ุญุณุงุจ ุงูุชุฐุงูุฑ
- [x] ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [x] ุฅูุดุงุก ุงููุซุงุฆู

### ุงูุงุฎุชุจุงุฑ:
- [ ] ุงุฎุชุจุงุฑ ุงููุดุงุฑูุฉ ุงูุฃุณุงุณูุฉ
- [ ] ุงุฎุชุจุงุฑ ุนุฑุถ ุงูุฃุณุฆูุฉ
- [ ] ุงุฎุชุจุงุฑ ุญูู ุงูุฏููู
- [ ] ุงุฎุชุจุงุฑ ุญุณุงุจ ุงูุชุฐุงูุฑ
- [ ] ุงุฎุชุจุงุฑ ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- [ ] ุงุฎุชุจุงุฑ ุงูุฃูุงู
- [ ] ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก

### ุงููุดุฑ:
- [ ] ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฅูุชุงุฌูุฉ
- [ ] ูุดุฑ ุงูููุฏ
- [ ] ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก
- [ ] ุฌูุน ุงูููุงุญุธุงุช

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅููุงู ุฌููุน ุงูุชุญุณููุงุช ุงููุทููุจุฉ ุจูุฌุงุญ! ุงููุธุงู ุงูุขู:

โ **ุฃูุซุฑ ุฏูุฉ** - ูุนูููุงุช ููุตูุฉ ุนู ุงูุทูุงุจ
โ **ุฃูุซุฑ ููุซูููุฉ** - ุงูุชุฒุงู ุจูุชุงุจุฉ ุงูุฏููู
โ **ุฃูุซุฑ ุดูุงููุฉ** - ุนุฑุถ ุงูุชุฐุงูุฑ ุงูููุชุณุจุฉ
โ **ุฃูุซุฑ ูุฑููุฉ** - ูุธุงู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
โ **ุฃูุถู ุชุฌุฑุจุฉ** - ูุงุฌูุฉ ูุณุชุฎุฏู ูุญุณูุฉ

---

**ุชุงุฑูุฎ ุงูุฅููุงู:** 28 ููุงูุฑ 2026
**ุงูุญุงูุฉ:** โ ููุชูู
**ุงูุฅุตุฏุงุฑ:** 2.0.0
