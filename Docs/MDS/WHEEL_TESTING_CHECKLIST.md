# ✅ قائمة اختبار نظام عجلة الحظ

## المرحلة 1: الإعداد الأولي

- [ ] تشغيل SQL migration: `supabase_wheel_enhanced.sql`
- [ ] التحقق من وجود جدول `wheel_runs`
- [ ] التحقق من الأعمدة الجديدة
- [ ] التحقق من RLS policies
- [ ] إنشاء مستخدم بصلاحية LRC_MANAGER
- [ ] إنشاء مستخدم بصلاحية CEO

## المرحلة 2: إنشاء البيانات التجريبية

- [ ] إنشاء مسابقة نشطة
- [ ] إضافة 5+ طلاب
- [ ] إضافة تذاكر للطلاب (أعداد مختلفة)
- [ ] التحقق من ظهور التذاكر في جدول `tickets`

## المرحلة 3: اختبار قفل القائمة

- [ ] تسجيل الدخول كـ LRC_MANAGER
- [ ] الوصول إلى صفحة إدارة العجلة
- [ ] اختيار المسابقة
- [ ] التحقق من ظهور الطلاب المؤهلين
- [ ] التحقق من حساب الاحتماليات
- [ ] قفل القائمة
- [ ] التحقق من رسالة النجاح
- [ ] محاولة القفل مرة أخرى (يجب أن تفشل)
- [ ] التحقق من Audit Log

## المرحلة 4: اختبار السحب

- [ ] التحقق من ظهر زر "تنفيذ السحب"
- [ ] تنفيذ السحب
- [ ] التحقق من ظهور الفائز
- [ ] التحقق من Hash التحقق
- [ ] محاولة السحب مرة أخرى (يجب أن تفشل)
- [ ] التحقق من Audit Log

## المرحلة 5: اختبار النشر

- [ ] فتح نافذة "إدارة نشر النتيجة"
- [ ] تفعيل "نشر النتيجة"
- [ ] تفعيل "إظهار اسم الفائز"
- [ ] إضافة اسم عرض بديل
- [ ] إضافة رسالة إعلان
- [ ] مراجعة المعاينة
- [ ] حفظ الإعدادات
- [ ] التحقق من Audit Log

## المرحلة 6: اختبار الصفحة العامة

- [ ] فتح `/wheel` في متصفح جديد
- [ ] التحقق من ظهور النتيجة
- [ ] التحقق من عرض اسم الفائز
- [ ] التحقق من رسالة الإعلان
- [ ] اختبار زر "إعادة السحب"
- [ ] التحقق من عرض الإحصائيات
- [ ] التحقق من Hash التحقق

## المرحلة 7: اختبار إعادة التعيين (CEO فقط)

- [ ] تسجيل الدخول كـ CEO
- [ ] محاولة إعادة التعيين
- [ ] إدخال سبب قصير (يجب أن تفشل)
- [ ] إدخال سبب صحيح (10+ أحرف)
- [ ] تأكيد العملية
- [ ] التحقق من حذف البيانات
- [ ] التحقق من Audit Log

## المرحلة 8: اختبار الصلاحيات

- [ ] محاولة الوصول كطالب عادي (يجب أن تفشل)
- [ ] محاولة القفل كـ LRC_MANAGER (يجب أن تنجح)
- [ ] محاولة الإعادة كـ LRC_MANAGER (يجب أن تفشل)
- [ ] محاولة الإعادة كـ CEO (يجب أن تنجح)

## المرحلة 9: اختبار API

- [ ] `GET /api/wheel/public?competitionId=xxx` (قبل النشر)
- [ ] التحقق من عدم ظهور البيانات
- [ ] نشر النتائج
- [ ] `GET /api/wheel/public?competitionId=xxx` (بعد النشر)
- [ ] التحقق من ظهور البيانات
- [ ] التحقق من إخفاء البيانات الحساسة

## المرحلة 10: اختبار الأداء

- [ ] إضافة 50+ طالب
- [ ] قفل القائمة
- [ ] قياس وقت الاستجابة
- [ ] تنفيذ السحب
- [ ] قياس وقت الاستجابة
- [ ] فتح الصفحة العامة
- [ ] قياس وقت التحميل

## ✅ النتيجة النهائية

- [ ] جميع الاختبارات نجحت
- [ ] لا توجد أخطاء في Console
- [ ] Audit Logs كاملة
- [ ] الأداء مقبول
- [ ] تجربة المستخدم ممتازة

---

**ملاحظات:**
- سجل أي مشاكل في ملف منفصل
- راجع Audit Logs بعد كل عملية
- تأكد من النسخ الاحتياطية قبل الاختبار
