# ๐ง ุญู ูุดููุฉ ุงูุชุณุฌูู - ุฏููู ุดุงูู

## ๐ ุงููุดููุฉ
ุนูุฏ ูุญุงููุฉ ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏุ ูุธูุฑ ุงูุฎุทุฃ:
```
ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุงูุญุณุงุจ. ุญุงูู ูุฑุฉ ุฃุฎุฑู.
```

## ๐ ุงูุณุจุจ ุงูุฌุฐุฑู
ุงููุดููุฉ ุชููู ูู **ุณูุงุณุงุช Row Level Security (RLS)** ูู ูุงุนุฏุฉ ุจูุงูุงุช Supabase:

1. ุนูุฏ ุงูุชุณุฌููุ ุงููุณุชุฎุฏู ูููู **ุบูุฑ ูุตุงุฏู ุนููู** (anon role)
2. ุงูุณูุงุณุงุช ุงูุญุงููุฉ **ูุง ุชุณูุญ** ูููุณุชุฎุฏููู ุบูุฑ ุงููุตุงุฏููู ุจู:
   - ูุฑุงุกุฉ ุฌุฏูู `student_participants` (ููุชุญูู ูู ุงุณู ุงููุณุชุฎุฏู)
   - ุฅุถุงูุฉ ุตููู ุฌุฏูุฏุฉ (ูุฅูุดุงุก ุงูุญุณุงุจ)
3. ูุฐุง ูุณุจุจ ูุดู ุนูููุฉ ุงูุชุณุฌูู

## โ ุงูุญู ุงููุงูู

### ุงูุฎุทูุฉ 1๏ธโฃ: ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

1. **ุงูุชุญ ููุญุฉ ุชุญูู Supabase**
   - ุงุฐูุจ ุฅูู: https://app.supabase.com
   - ุงุฎุชุฑ ูุดุฑูุนู

2. **ุงูุชุญ SQL Editor**
   - ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ "SQL Editor"
   - ุฃู ุงุฐูุจ ูุจุงุดุฑุฉ ุฅูู: `https://app.supabase.com/project/YOUR_PROJECT/sql`

3. **ููุฐ ููู ุงูุฅุตูุงุญ**
   - ุงูุชุญ ููู `fix_signup_complete.sql`
   - ุงูุณุฎ **ูู** ุงููุญุชูู
   - ุงูุตูู ูู SQL Editor
   - ุงุถุบุท **Run** ุฃู **Ctrl+Enter**

4. **ุชุญูู ูู ุงููุฌุงุญ**
   - ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ: โ ุชู ุชุทุจูู ุงูุฅุตูุงุญ ุจูุฌุงุญ!
   - ูุฌุจ ุฃู ุชุฑู ุนุฏุฏ ุงูุณูุงุณุงุช ุงููุทุจูุฉ (4 ุณูุงุณุงุช)

### ุงูุฎุทูุฉ 2๏ธโฃ: ุงูุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ

ุชุฃูุฏ ูู ุฃู ููู `.env` ูุญุชูู ุนูู:

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here

# Role Codes (ุงุฎุชูุงุฑู)
CEO_ROLE_CODE=your-ceo-code
MANAGER_ROLE_CODE=your-manager-code
ADMIN_ROLE_CODE=your-admin-code
```

**ููููุฉ ุงูุญุตูู ุนูู ุงูููุงุชูุญ:**
1. ูู ููุญุฉ ุชุญูู Supabase
2. ุงุฐูุจ ุฅูู Settings โ API
3. ุงูุณุฎ:
   - Project URL โ `NEXT_PUBLIC_SUPABASE_URL`
   - anon/public key โ `NEXT_PUBLIC_SUPABASE_ANON_KEY`

### ุงูุฎุทูุฉ 3๏ธโฃ: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู

```bash
# ุฃููู ุงูุฎุงุฏู (Ctrl+C)
# ุซู ุฃุนุฏ ุงูุชุดุบูู
npm run dev
```

### ุงูุฎุทูุฉ 4๏ธโฃ: ุงุฎุชุจุงุฑ ุงูุชุณุฌูู

1. ุงูุชุญ ุงููุชุตูุญ ุนูู: http://localhost:3000/signup
2. ุฃุฏุฎู:
   - ุงุณู ูุณุชุฎุฏู: `test_user_123`
   - ูููุฉ ูุฑูุฑ: `password123`
   - ุฑูุฒ ุงูุฏูุฑ: (ุงุชุฑูู ูุงุฑุบุงู)
3. ุงุถุบุท "ุฅูุดุงุก ุญุณุงุจ"
4. ูุฌุจ ุฃู ูุชู:
   - โ ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ
   - โ ุงูุงูุชูุงู ุฅูู ููุญุฉ ุงูุชุญูู
   - โ ุนุฑุถ ุฑุณุงูุฉ ุชุฑุญูุจ

## ๐ง ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### 1. ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (fix_signup_complete.sql)

#### ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ:
```sql
-- 1. ุงูุณูุงุญ ุจุงูุชุณุฌูู ููุฌููุน
CREATE POLICY "Enable insert for anon users"
  ON student_participants FOR INSERT
  TO anon, authenticated
  WITH CHECK (true);

-- 2. ุงูุณูุงุญ ุจูุฑุงุกุฉ ุงูุจูุงูุงุช
CREATE POLICY "Enable select for anon users"
  ON student_participants FOR SELECT
  TO anon, authenticated
  USING (true);

-- 3. ุงูุณูุงุญ ุจุงูุชุญุฏูุซ
CREATE POLICY "Enable update for users based on id"
  ON student_participants FOR UPDATE
  TO authenticated
  USING (true) WITH CHECK (true);

-- 4. ุงูุณูุงุญ ุจุงูุญุฐู
CREATE POLICY "Enable delete for users based on id"
  ON student_participants FOR DELETE
  TO authenticated
  USING (true);
```

### 2. ูู ุงูููุฏ (app/signup/actions.ts)

#### ุงูุชุญุณููุงุช:
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฃูุถู ูุน ุฑุณุงุฆู ุชูุตูููุฉ
- โ ุชุณุฌูู ุงูุฃุฎุทุงุก ูู console ููุชุดุฎูุต
- โ ุฑุณุงุฆู ุฎุทุฃ ูุญุฏุฏุฉ ุญุณุจ ููุน ุงููุดููุฉ:
  - `23505`: ุงุณู ูุณุชุฎุฏู ููุฑุฑ
  - `42501`: ูุดููุฉ ูู ุงูุตูุงุญูุงุช (RLS)
- โ ุนุฑุถ ุฑุณุงูุฉ ุงูุฎุทุฃ ุงููุนููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐งช ุญุงูุงุช ุงูุงุฎุชุจุงุฑ

### โ ุญุงูุงุช ุงููุฌุงุญ:
1. **ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ**
   - ุงุณู ูุณุชุฎุฏู: `student1`
   - ูููุฉ ูุฑูุฑ: `password123`
   - ุงููุชูุฌุฉ: โ ูุฌุญ

2. **ุชุณุฌูู ุจุฏูุฑ ูุนูู**
   - ุงุณู ูุณุชุฎุฏู: `manager1`
   - ูููุฉ ูุฑูุฑ: `password123`
   - ุฑูุฒ ุงูุฏูุฑ: `MANAGER_CODE`
   - ุงููุชูุฌุฉ: โ ูุฌุญ

### โ ุญุงูุงุช ุงููุดู ุงููุชููุนุฉ:
1. **ุงุณู ูุณุชุฎุฏู ููุฑุฑ**
   - ุงููุชูุฌุฉ: โ "ุงุณู ุงููุณุชุฎุฏู ูุณุชุฎุฏู ุจุงููุนู"

2. **ูููุฉ ูุฑูุฑ ูุตูุฑุฉ**
   - ุงููุชูุฌุฉ: โ "ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ุชููู 8 ุฃุญุฑู ุนูู ุงูุฃูู"

3. **ุงุณู ูุณุชุฎุฏู ุบูุฑ ุตุงูุญ**
   - ุงููุชูุฌุฉ: โ "ุงุณู ุงููุณุชุฎุฏู ูุฌุจ ุฃู ูุญุชูู ุนูู ุญุฑูู ูุฃุฑูุงู ูุดุฑุทุฉ ุณูููุฉ ููุท"

## ๐ ููุงุญุธุงุช ุงูุฃูุงู

### ูู ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ ุขููุฉุ
**ูุนู!** ูุฅููู ุงูุณุจุจ:

1. **ูููุงุช ุงููุฑูุฑ ูุดูุฑุฉ**
   - ูุชู ุชุดููุฑูุง ุจุงุณุชุฎุฏุงู SHA-256
   - ูุง ูููู ูุฑุงุกุชูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

2. **ูุง ูุนูููุงุช ุญุณุงุณุฉ**
   - ุงูุฌุฏูู ูุญุชูู ููุท ุนูู:
     - ุงุณู ุงููุณุชุฎุฏู (ุนุงู)
     - ูููุฉ ุงููุฑูุฑ ุงููุดูุฑุฉ
     - ุงูุฏูุฑ
     - ุชุงุฑูุฎ ุงูุฅูุดุงุก

3. **ุงููุฑุงุกุฉ ููุชุญูู ููุท**
   - ุงูุณูุงุญ ุจุงููุฑุงุกุฉ ุถุฑูุฑู ููุชุญูู ูู ุชูุฑุงุฑ ุงุณู ุงููุณุชุฎุฏู
   - ูุฐุง ูุนูุงุฑ ูู ูุนุธู ุงูุชุทุจููุงุช

4. **ุงููุชุงุจุฉ ูุญุฏูุฏุฉ**
   - ูููู ููุฌููุน ุงูุฅุถุงูุฉ (ุงูุชุณุฌูู)
   - ููู ุงูุชุญุฏูุซ ูุงูุญุฐู ูููุณุชุฎุฏููู ุงููุตุงุฏููู ููุท

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:

#### 1. ุชุญูู ูู Console ูู ุงููุชุตูุญ
```
F12 โ Console
```
ุงุจุญุซ ุนู ุฑุณุงุฆู ุฎุทุฃ ูุซู:
- `Username check error`
- `Student creation error`
- `Error code: 42501` (ูุดููุฉ RLS)
- `Error code: 23505` (ุงุณู ูุณุชุฎุฏู ููุฑุฑ)

#### 2. ุชุญูู ูู Supabase Logs
1. ูู ููุญุฉ ุชุญูู Supabase
2. ุงุฐูุจ ุฅูู: Logs โ API Logs
3. ุงุจุญุซ ุนู ุทูุจุงุช ูุงุดูุฉ (status 400 ุฃู 500)

#### 3. ุชุญูู ูู ุงูุณูุงุณุงุช
ููุฐ ูุฐุง ูู SQL Editor:
```sql
SELECT 
  policyname,
  cmd,
  roles
FROM pg_policies
WHERE tablename = 'student_participants';
```

ูุฌุจ ุฃู ุชุฑู 4 ุณูุงุณุงุช:
- `Enable insert for anon users`
- `Enable select for anon users`
- `Enable update for users based on id`
- `Enable delete for users based on id`

#### 4. ุชุญูู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
ููุฐ ูุฐุง ูู terminal:
```bash
# ุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
echo $NEXT_PUBLIC_SUPABASE_URL
echo $NEXT_PUBLIC_SUPABASE_ANON_KEY
```

#### 5. ุงูุณุญ ุงููุงุด ูุฃุนุฏ ุงูุชุดุบูู
```bash
# ุงูุณุญ .next folder
rm -rf .next

# ุฃุนุฏ ุชุซุจูุช dependencies
npm install

# ุฃุนุฏ ุงูุชุดุบูู
npm run dev
```

## ๐ ุงูุญุตูู ุนูู ุงููุณุงุนุฏุฉ

ุฅุฐุง ุฌุฑุจุช ูู ุงูุญููู ููู ุชูุฌุญ:

1. **ุชุญูู ูู ุงููููุงุช ุงูุฃุฎุฑู:**
   - `SUPABASE_SETUP_GUIDE.md`
   - `AUTH_SETUP.md`
   - `QUICK_START_AUTH.md`

2. **ุฌูุน ุงููุนูููุงุช:**
   - ุฑุณุงุฆู ุงูุฎุทุฃ ูู Console
   - ุฑุณุงุฆู ุงูุฎุทุฃ ูู Supabase Logs
   - ูุชูุฌุฉ ุงุณุชุนูุงู ุงูุณูุงุณุงุช

3. **ุชุญูู ูู:**
   - ูู ุชู ุชูููุฐ `fix_signup_complete.sql` ุจูุฌุงุญุ
   - ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุตุญูุญุฉุ
   - ูู ุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจููุ

## ๐ฏ ุงูุฎูุงุตุฉ

ุงููุดููุฉ ูุงูุช ูู **ุณูุงุณุงุช RLS** ุงูุชู ุชููุน ุงููุณุชุฎุฏููู ุบูุฑ ุงููุตุงุฏููู ูู:
- โ ูุฑุงุกุฉ ุฌุฏูู ุงููุณุชุฎุฏููู (ููุชุญูู ูู ุงูุชูุฑุงุฑ)
- โ ุฅุถุงูุฉ ูุณุชุฎุฏููู ุฌุฏุฏ (ููุชุณุฌูู)

**ุงูุญู:**
1. ุชุญุฏูุซ ุงูุณูุงุณุงุช ูู Supabase (ููู `fix_signup_complete.sql`)
2. ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู ุงูููุฏ
3. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู

**ุงููุชูุฌุฉ:**
- โ ุงูุชุณุฌูู ูุนูู ุจูุฌุงุญ
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ
- โ ุฃูุงู ูุญุณูู

---

**ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ:** 2026-01-27
**ุงูุฅุตุฏุงุฑ:** 2.0
